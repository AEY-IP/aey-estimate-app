generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model act_coefficients {
  id          String  @id
  name        String
  value       Float
  description String?
  actId       String
  acts        acts    @relation(fields: [actId], references: [id], onDelete: Cascade)
}

model act_exports {
  id                  String   @id
  actId               String   @unique
  worksData           String
  materialsData       String
  totalWorksPrice     Float
  totalMaterialsPrice Float
  grandTotal          Float
  coefficientsInfo    String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  acts                acts     @relation(fields: [actId], references: [id], onDelete: Cascade)
}

model act_materials {
  id          String    @id
  name        String
  unit        String
  quantity    Float
  price       Float
  totalPrice  Float
  description String?
  roomId      String
  act_rooms   act_rooms @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model act_room_parameter_values {
  id              String          @id
  parameterId     String
  value           Float
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  actId           String?
  roomId          String?
  acts            acts?           @relation(fields: [actId], references: [id], onDelete: Cascade)
  room_parameters room_parameters @relation(fields: [parameterId], references: [id])
  act_rooms       act_rooms?      @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model act_rooms {
  id                        String                      @id
  name                      String
  totalWorksPrice           Float                       @default(0)
  totalMaterialsPrice       Float                       @default(0)
  totalPrice                Float                       @default(0)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  actId                     String
  act_materials             act_materials[]
  act_room_parameter_values act_room_parameter_values[]
  acts                      acts                        @relation(fields: [actId], references: [id], onDelete: Cascade)
  act_works                 act_works[]
}

model act_works {
  id             String      @id
  quantity       Float
  price          Float
  totalPrice     Float
  description    String?
  roomId         String
  workItemId     String?
  blockTitle     String?
  manualWorkName String?
  manualWorkUnit String?
  act_rooms      act_rooms   @relation(fields: [roomId], references: [id], onDelete: Cascade)
  work_items     work_items? @relation(fields: [workItemId], references: [id])
}

model acts {
  id                        String                      @id
  title                     String
  type                      String
  category                  String
  totalWorksPrice           Float                       @default(0)
  totalMaterialsPrice       Float                       @default(0)
  totalPrice                Float                       @default(0)
  notes                     String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  clientId                  String
  createdBy                 String
  coefficientSettings       String?
  coefficientsData          String?
  manualPrices              String?
  materialsBlock            String?
  summaryMaterialsBlock     String?
  summaryWorksBlock         String?
  worksBlock                String?
  showToClient              Boolean                     @default(false)
  act_coefficients          act_coefficients[]
  act_exports               act_exports?
  act_room_parameter_values act_room_parameter_values[]
  act_rooms                 act_rooms[]
  clients                   clients                     @relation(fields: [clientId], references: [id])
  users                     users                       @relation(fields: [createdBy], references: [id])
}

model client_users {
  id            String   @id
  username      String   @unique
  passwordHash  String
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  clientId      String   @unique
  plainPassword String?
  clients       clients  @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model clients {
  id                              String                   @id
  name                            String
  phone                           String?
  email                           String?
  address                         String?
  contractNumber                  String?
  notes                           String?
  isActive                        Boolean                  @default(true)
  createdAt                       DateTime                 @default(now())
  updatedAt                       DateTime
  createdBy                       String
  contractDate                    String?
  managerId                       String?
  designerId                      String?
  acts                            acts[]
  client_users                    client_users?
  users_clients_createdByTousers  users                    @relation("clients_createdByTousers", fields: [createdBy], references: [id])
  users_clients_designerIdTousers users?                   @relation("clients_designerIdTousers", fields: [designerId], references: [id])
  users_clients_managerIdTousers  users?                   @relation("clients_managerIdTousers", fields: [managerId], references: [id])
  design_project_blocks           design_project_blocks[]
  document_blocks                 document_blocks[]
  documents                       documents[]
  estimates                       estimates[]
  photo_blocks                    photo_blocks[]
  project_news                    project_news[]
  project_schedule_items          project_schedule_items[]
  receipt_blocks                  receipt_blocks[]
  schedule_projects               schedule_projects[]
}

model coefficients {
  id          String   @id
  name        String
  value       Float
  description String?
  isActive    Boolean  @default(true)
  category    String   @default("custom")
  createdAt   DateTime @default(now())
  type        String   @default("normal")
  updatedAt   DateTime
}

model deleted_estimates {
  id                  String   @id
  originalId          String
  title               String
  type                String
  category            String
  totalWorksPrice     Float
  totalMaterialsPrice Float
  totalPrice          Float
  notes               String?
  coefficientsData    String?
  coefficientSettings String?
  manualPrices        String?
  estimateData        String
  deletedAt           DateTime @default(now())
  deletedBy           String
  clientId            String
  originalCreatedBy   String
  originalCreatedAt   DateTime
  originalUpdatedAt   DateTime
  users               users    @relation(fields: [deletedBy], references: [id])
}

model design_project_blocks {
  id                   String                 @id
  title                String
  description          String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  clientId             String
  createdBy            String?
  eventDate            DateTime?
  isVisible            Boolean                @default(true)
  sortOrder            Int                    @default(0)
  tags                 String[]               @default([])
  clients              clients                @relation(fields: [clientId], references: [id], onDelete: Cascade)
  design_project_files design_project_files[]
}

model design_project_files {
  id                    String                @id
  fileName              String
  filePath              String
  fileSize              Int
  mimeType              String
  description           String?
  createdAt             DateTime              @default(now())
  blockId               String
  isVisible             Boolean               @default(true)
  sortOrder             Int                   @default(0)
  tags                  String[]              @default([])
  uploadedBy            String?
  design_project_blocks design_project_blocks @relation(fields: [blockId], references: [id], onDelete: Cascade)
}

model designer_clients {
  id                 String               @id
  name               String
  phone              String?
  email              String?
  address            String?
  notes              String?
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  designerId         String
  users              users                @relation(fields: [designerId], references: [id])
  designer_estimates designer_estimates[]
}

model designer_estimate_blocks {
  id                             String                     @id
  name                           String
  description                    String?
  level                          Int                        @default(1)
  parentId                       String?
  sortOrder                      Int                        @default(0)
  isActive                       Boolean                    @default(true)
  createdAt                      DateTime                   @default(now())
  updatedAt                      DateTime
  estimateId                     String
  designer_estimates             designer_estimates         @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  designer_estimate_blocks       designer_estimate_blocks?  @relation("designer_estimate_blocksTodesigner_estimate_blocks", fields: [parentId], references: [id], onDelete: Cascade)
  other_designer_estimate_blocks designer_estimate_blocks[] @relation("designer_estimate_blocksTodesigner_estimate_blocks")
  designer_estimate_items        designer_estimate_items[]
}

model designer_estimate_items {
  id                       String                   @id
  name                     String
  manufacturer             String?
  link                     String?
  imageUrl                 String?
  unit                     String
  pricePerUnit             Float                    @default(0)
  quantity                 Float                    @default(1)
  totalPrice               Float                    @default(0)
  sortOrder                Int                      @default(0)
  notes                    String?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  blockId                  String
  designer_estimate_blocks designer_estimate_blocks @relation(fields: [blockId], references: [id], onDelete: Cascade)
}

model designer_estimates {
  id                       String                     @id
  name                     String
  description              String?
  isActive                 Boolean                    @default(true)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  clientId                 String
  designerId               String
  designer_estimate_blocks designer_estimate_blocks[]
  designer_clients         designer_clients           @relation(fields: [clientId], references: [id], onDelete: Cascade)
  users                    users                      @relation(fields: [designerId], references: [id])
}

model document_blocks {
  id          String      @id
  title       String
  description String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  clientId    String
  createdBy   String?
  eventDate   DateTime?
  isVisible   Boolean     @default(true)
  sortOrder   Int         @default(0)
  tags        String[]    @default([])
  clients     clients     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  documents   documents[]
}

model documents {
  id              String           @id
  name            String
  fileName        String
  filePath        String
  fileSize        Int
  mimeType        String
  description     String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  clientId        String
  isVisible       Boolean          @default(true)
  sortOrder       Int              @default(0)
  tags            String?
  uploadedBy      String?
  category        String           @default("document")
  blockId         String?
  document_blocks document_blocks? @relation(fields: [blockId], references: [id], onDelete: Cascade)
  clients         clients          @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model estimate_coefficients {
  id          String    @id
  name        String
  value       Float
  description String?
  estimateId  String
  estimates   estimates @relation(fields: [estimateId], references: [id], onDelete: Cascade)
}

model estimate_exports {
  id                  String    @id
  estimateId          String    @unique
  worksData           String
  materialsData       String
  totalWorksPrice     Float
  totalMaterialsPrice Float
  grandTotal          Float
  coefficientsInfo    String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  estimates           estimates @relation(fields: [estimateId], references: [id], onDelete: Cascade)
}

model estimate_materials {
  id             String         @id
  name           String
  unit           String
  quantity       Float
  price          Float
  totalPrice     Float
  description    String?
  roomId         String
  estimate_rooms estimate_rooms @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model estimate_room_parameter_values {
  id              String          @id
  parameterId     String
  value           Float
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  estimateId      String?
  roomId          String?
  estimates       estimates?      @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  room_parameters room_parameters @relation(fields: [parameterId], references: [id])
  estimate_rooms  estimate_rooms? @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model estimate_rooms {
  id                             String                           @id
  name                           String
  totalWorksPrice                Float                            @default(0)
  totalMaterialsPrice            Float                            @default(0)
  totalPrice                     Float                            @default(0)
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  estimateId                     String
  sortOrder                      Int                              @default(0)
  estimate_materials             estimate_materials[]
  estimate_room_parameter_values estimate_room_parameter_values[]
  estimates                      estimates                        @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  estimate_works                 estimate_works[]
}

model estimate_works {
  id             String         @id
  quantity       Float
  price          Float
  totalPrice     Float
  description    String?
  roomId         String
  workItemId     String?
  blockTitle     String?
  manualWorkName String?
  manualWorkUnit String?
  estimate_rooms estimate_rooms @relation(fields: [roomId], references: [id], onDelete: Cascade)
  work_items     work_items?    @relation(fields: [workItemId], references: [id])
}

model estimates {
  id                             String                           @id
  title                          String
  type                           String
  category                       String
  totalWorksPrice                Float                            @default(0)
  totalMaterialsPrice            Float                            @default(0)
  totalPrice                     Float                            @default(0)
  notes                          String?
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  clientId                       String
  createdBy                      String
  coefficientSettings            String?
  coefficientsData               String?
  manualPrices                   String?
  materialsBlock                 String?
  showToClient                   Boolean                          @default(false)
  summaryMaterialsBlock          String?
  summaryWorksBlock              String?
  worksBlock                     String?
  isAct                          Boolean                          @default(false)
  estimate_coefficients          estimate_coefficients[]
  estimate_exports               estimate_exports?
  estimate_room_parameter_values estimate_room_parameter_values[]
  estimate_rooms                 estimate_rooms[]
  clients                        clients                          @relation(fields: [clientId], references: [id])
  users                          users                            @relation(fields: [createdBy], references: [id])
}

model lead_requests {
  id             String   @id
  name           String
  phone          String
  services       String[]
  contactMethods String[]
  status         String   @default("new")
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
}

model photo_blocks {
  id          String    @id
  title       String
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  clientId    String
  createdBy   String?
  eventDate   DateTime?
  isVisible   Boolean   @default(true)
  sortOrder   Int       @default(0)
  tags        String[]  @default([])
  clients     clients   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  photos      photos[]
}

model photos {
  id           String       @id
  fileName     String
  filePath     String
  fileSize     Int
  mimeType     String
  description  String?
  createdAt    DateTime     @default(now())
  blockId      String
  isVisible    Boolean      @default(true)
  sortOrder    Int          @default(0)
  tags         String[]     @default([])
  uploadedBy   String?
  photo_blocks photo_blocks @relation(fields: [blockId], references: [id], onDelete: Cascade)
}

model project_news {
  id           String   @id
  title        String
  content      String
  comment      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  clientId     String
  type         String   @default("other")
  showToClient Boolean  @default(true)
  clients      clients  @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model project_schedule_items {
  id          String   @id
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime
  progress    Int      @default(0)
  status      String   @default("not_started")
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  clientId    String
  clients     clients  @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model receipt_blocks {
  id          String     @id
  title       String
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  clientId    String
  createdBy   String?
  eventDate   DateTime?
  isVisible   Boolean    @default(true)
  sortOrder   Int        @default(0)
  tags        String[]   @default([])
  clients     clients    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  receipts    receipts[]
}

model receipts {
  id             String         @id
  fileName       String
  filePath       String
  fileSize       Int
  mimeType       String
  description    String?
  createdAt      DateTime       @default(now())
  blockId        String
  isVisible      Boolean        @default(true)
  sortOrder      Int            @default(0)
  tags           String[]       @default([])
  uploadedBy     String?
  receipt_blocks receipt_blocks @relation(fields: [blockId], references: [id], onDelete: Cascade)
}

model room_parameters {
  id                             String                           @id
  name                           String
  unit                           String
  description                    String?
  isActive                       Boolean                          @default(true)
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  act_room_parameter_values      act_room_parameter_values[]
  estimate_room_parameter_values estimate_room_parameter_values[]
  work_items                     work_items[]
}

model schedule_projects {
  id             String           @id
  clientId       String
  title          String
  description    String?
  startDate      DateTime
  endDate        DateTime
  status         String           @default("active")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  createdBy      String
  showToClient   Boolean          @default(false)
  clients        clients          @relation(fields: [clientId], references: [id])
  users          users            @relation(fields: [createdBy], references: [id])
  schedule_tasks schedule_tasks[]
}

model schedule_tasks {
  id                   String            @id
  projectId            String
  parentId             String?
  title                String
  description          String?
  level                Int               @default(0)
  orderIndex           Int               @default(0)
  plannedStart         DateTime
  plannedEnd           DateTime
  actualStart          DateTime?
  actualEnd            DateTime?
  progress             Float             @default(0)
  status               String            @default("waiting")
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  schedule_tasks       schedule_tasks?   @relation("schedule_tasksToschedule_tasks", fields: [parentId], references: [id])
  other_schedule_tasks schedule_tasks[]  @relation("schedule_tasksToschedule_tasks")
  schedule_projects    schedule_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model template_materials {
  id             String         @id
  name           String
  unit           String
  quantity       Float
  price          Float
  totalPrice     Float
  description    String?
  roomId         String
  template_rooms template_rooms @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model template_rooms {
  id                   String                 @id
  name                 String
  totalWorksPrice      Float                  @default(0)
  totalMaterialsPrice  Float                  @default(0)
  totalPrice           Float                  @default(0)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  templateId           String
  sortOrder            Int                    @default(0)
  template_materials   template_materials[]
  templates            templates              @relation(fields: [templateId], references: [id], onDelete: Cascade)
  template_work_blocks template_work_blocks[]
  template_works       template_works[]
}

model template_work_blocks {
  id             String           @id
  title          String
  description    String?
  totalPrice     Float            @default(0)
  isCollapsed    Boolean          @default(false)
  sortOrder      Int              @default(0)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  roomId         String
  template_rooms template_rooms   @relation(fields: [roomId], references: [id], onDelete: Cascade)
  template_works template_works[]
}

model template_works {
  id                   String                @id
  quantity             Float
  price                Float
  totalPrice           Float
  description          String?
  roomId               String
  workItemId           String?
  blockTitle           String?
  manualWorkName       String?
  manualWorkUnit       String?
  workBlockId          String?
  template_rooms       template_rooms        @relation(fields: [roomId], references: [id], onDelete: Cascade)
  template_work_blocks template_work_blocks? @relation(fields: [workBlockId], references: [id], onDelete: Cascade)
  work_items           work_items?           @relation(fields: [workItemId], references: [id])
}

model templates {
  id                    String           @id
  name                  String
  type                  String
  description           String?
  totalWorksPrice       Float            @default(0)
  totalMaterialsPrice   Float            @default(0)
  totalPrice            Float            @default(0)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime
  createdBy             String
  materialsBlock        String?
  summaryMaterialsBlock String?
  summaryWorksBlock     String?
  worksBlock            String?
  isActive              Boolean          @default(true)
  template_rooms        template_rooms[]
  users                 users            @relation(fields: [createdBy], references: [id])
}

model users {
  id                                String               @id
  username                          String               @unique
  passwordHash                      String
  role                              String
  name                              String
  phone                             String?
  isActive                          Boolean              @default(true)
  createdAt                         DateTime             @default(now())
  updatedAt                         DateTime
  designerType                      String?
  companyName                       String?
  resourceLinks                     Json?
  acts                              acts[]
  clients_clients_createdByTousers  clients[]            @relation("clients_createdByTousers")
  clients_clients_designerIdTousers clients[]            @relation("clients_designerIdTousers")
  clients_clients_managerIdTousers  clients[]            @relation("clients_managerIdTousers")
  deleted_estimates                 deleted_estimates[]
  designer_clients                  designer_clients[]
  designer_estimates                designer_estimates[]
  estimates                         estimates[]
  schedule_projects                 schedule_projects[]
  templates                         templates[]
}

model work_blocks {
  id          String       @id
  title       String
  description String?
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  work_items  work_items[]
}

model work_items {
  id              String           @id
  name            String
  unit            String
  price           Float
  description     String?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  blockId         String
  parameterId     String?
  act_works       act_works[]
  estimate_works  estimate_works[]
  template_works  template_works[]
  work_blocks     work_blocks      @relation(fields: [blockId], references: [id])
  room_parameters room_parameters? @relation(fields: [parameterId], references: [id])
}

model works {
  id          String   @id
  name        String
  unit        String
  basePrice   Float
  category    String
  description String?
  parameterId String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}
